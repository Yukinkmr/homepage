---
import { t } from '../i18n/utils';
import type { Lang } from '../i18n/utils';

interface Props {
  lang: Lang;
  profile: {
    education: Array<{
      id: string;
      title_ja: string;
      title_en: string;
      org_ja: string;
      org_en: string;
      period: string;
      bullets_ja: string[];
      bullets_en: string[];
      links: Array<{ label: string; url: string }>;
    }>;
    experience: Array<{
      id: string;
      title_ja: string;
      title_en: string;
      org_ja: string;
      org_en: string;
      period: string;
      bullets_ja: string[];
      bullets_en: string[];
      links: Array<{ label: string; url: string }>;
    }>;
    certifications: Array<{
      id: string;
      title_ja: string;
      title_en: string;
      org_ja: string;
      org_en: string;
      period: string;
      bullets_ja: string[];
      bullets_en: string[];
      links: Array<{ label: string; url: string }>;
    }>;
  };
  name: string;
  nameEn: string;
  nameJa: string;
  university: string;
  tagline: string;
  subtitle: string;
  base?: string;
}

const { lang, profile, name, nameEn, nameJa, university, tagline, subtitle, base = '' } = Astro.props;
const b = base.endsWith('/') ? base : base ? base + '/' : '';

const getTitle = (item: { title_ja: string; title_en: string }) => 
  lang === 'ja' ? item.title_ja : item.title_en;
const getOrg = (item: { org_ja: string; org_en: string }) => 
  lang === 'ja' ? item.org_ja : item.org_en;
const getBullets = (item: { bullets_ja: string[]; bullets_en: string[] }) => 
  lang === 'ja' ? item.bullets_ja : item.bullets_en;

// モバイル時に半角スペースで改行する関数
const formatOrgForMobile = (org: string) => {
  // 半角スペースを <span class="md:hidden"><br></span><span class="hidden md:inline"> </span> に置き換え
  return org.split(' ').map((part, index, array) => {
    if (index === array.length - 1) {
      return part;
    }
    return `${part}<span class="md:hidden"><br></span><span class="hidden md:inline"> </span>`;
  }).join('');
};
---

<div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-10 md:p-14 lg:p-20 mb-16 hover:border-cyan-500/50 transition-colors animate-fade-in-up" data-animate>
  <!-- Self Introduction -->
  <div class="flex flex-col md:flex-row items-center md:items-start gap-6 mb-8 pb-8 border-b border-gray-700">
    <img 
      src={`${b}icon.jpg`}
      alt={name}
      class="w-32 h-32 md:w-40 md:h-40 rounded-full object-cover border-4 border-cyan-400/50 flex-shrink-0"
    />
    <div class="text-center md:text-left flex-grow">
      <div class="mb-4">
        <div class="flex flex-wrap items-center justify-center md:justify-start gap-3 md:gap-4">
          <h2 class="text-5xl md:text-6xl lg:text-7xl font-bold text-gray-100 tracking-tight">
            {name}
          </h2>
          <div class="flex items-center gap-2">
            <a href="https://github.com/Yukinkmr" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-cyan-400 transition-colors p-1.5 rounded-lg hover:bg-gray-700/50" aria-label="GitHub">
              <svg class="w-8 h-8 md:w-9 md:h-9" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
              </svg>
            </a>
            <a href="https://x.com/yukinkmr_soccer" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-cyan-400 transition-colors p-1.5 rounded-lg hover:bg-gray-700/50" aria-label="X">
              <svg class="w-8 h-8 md:w-9 md:h-9" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
              </svg>
            </a>
          </div>
        </div>
        <p class="text-2xl md:text-3xl lg:text-4xl text-gray-500 mt-1">
          {lang === 'ja' ? nameEn : nameJa}
        </p>
      </div>
      <div class="text-xl md:text-2xl text-gray-400 font-light space-y-1">
        <div>{lang === 'ja' ? '2003年9月15日生まれ' : 'Born September 15, 2003'}</div>
        <div>{university}</div>
        <div>{tagline}</div>
        <div>{subtitle}</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex border-b border-gray-700 mb-6">
    <button
      class="tab-button flex-1 px-6 py-3 text-lg md:text-xl font-semibold text-gray-400 hover:text-cyan-400 border-b-2 border-transparent hover:border-cyan-500 transition-colors text-center"
      data-tab="education"
    >
      {t('home.sections.education', lang)}
    </button>
    <button
      class="tab-button flex-1 px-6 py-3 text-lg md:text-xl font-semibold text-gray-400 hover:text-cyan-400 border-b-2 border-transparent hover:border-cyan-500 transition-colors text-center"
      data-tab="experience"
    >
      {t('home.sections.experience', lang)}
    </button>
    <button
      class="tab-button flex-1 px-6 py-3 text-lg md:text-xl font-semibold text-gray-400 hover:text-cyan-400 border-b-2 border-transparent hover:border-cyan-500 transition-colors text-center"
      data-tab="certifications"
    >
      {t('home.sections.certifications', lang)}
    </button>
  </div>

  <!-- Education Tab Content -->
  <div id="tab-education" class="tab-content">
    <div class="space-y-8 md:space-y-10 lg:space-y-12">
      {[...profile.education].reverse().map((item) => (
        <div>
          <h4 class="text-lg md:text-xl lg:text-2xl font-medium text-gray-500 mb-2">
            {getTitle(item)}
          </h4>
          <p class="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-100 mb-2" set:html={formatOrgForMobile(getOrg(item))}></p>
          {item.period && (
            <p class="text-base md:text-lg text-gray-500 mb-2">
              {item.period}
            </p>
          )}
          {getBullets(item).length > 0 && (
            <ul class="list-disc list-inside text-lg md:text-xl lg:text-2xl text-gray-400 space-y-1 ml-2">
              {getBullets(item).map((bullet) => (
                <li>{bullet}</li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </div>
  </div>

  <!-- Experience Tab Content -->
  <div id="tab-experience" class="tab-content hidden">
    <div class="space-y-8 md:space-y-10 lg:space-y-12">
      {profile.experience.map((item) => (
        <div>
          <h4 class="text-2xl md:text-3xl lg:text-4xl font-semibold text-gray-100 mb-1">
            {getTitle(item)}
          </h4>
          <p class="text-xl md:text-2xl lg:text-3xl font-medium text-gray-300 mb-1">
            {getOrg(item)}
          </p>
          {item.period && (
            <p class="text-base md:text-lg text-gray-500 mb-2">
              {item.period}
            </p>
          )}
          {getBullets(item).length > 0 && (
            <ul class="list-disc list-inside text-lg md:text-xl lg:text-2xl text-gray-400 space-y-1 ml-2">
              {getBullets(item).map((bullet) => (
                <li>{bullet}</li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </div>
  </div>

  <!-- Certifications Tab Content -->
  <div id="tab-certifications" class="tab-content hidden">
    <div class="space-y-8 md:space-y-10 lg:space-y-12">
      {profile.certifications.map((item) => {
        const bullets = getBullets(item);
        const hasScore = bullets.length > 0 && (bullets[0].includes('スコア') || bullets[0].includes('Score'));
        const scoreText = hasScore ? bullets[0] : null;
        const displayTitle = scoreText ? `${getTitle(item)} ${scoreText}` : getTitle(item);
        
        return (
          <div>
                  <h4 class="text-2xl md:text-3xl lg:text-4xl font-semibold text-gray-100 mb-1">
                    {displayTitle}
                  </h4>
                  {lang === 'en' && (
                    <p class="text-xl md:text-2xl lg:text-3xl font-medium text-gray-300 mb-1">
                      {getOrg(item)}
                    </p>
                  )}
                  {bullets.length > 0 && !hasScore && (
                    <ul class="list-disc list-inside text-lg md:text-xl lg:text-2xl text-gray-400 space-y-1 ml-2 mb-1">
                      {bullets.map((bullet) => (
                        <li>{bullet}</li>
                      ))}
                    </ul>
                  )}
                  <p class="text-base md:text-lg text-gray-500">
                    {item.period}
                  </p>
          </div>
        );
      })}
    </div>
  </div>
</div>

<script>
  if (typeof document !== 'undefined') {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // 最初のタブをアクティブにする
    if (tabButtons.length > 0 && tabContents.length > 0) {
      tabButtons[0].classList.add('active');
      tabContents[0].classList.remove('hidden');
      
      tabButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const targetTab = button.getAttribute('data-tab');
          
          // すべてのタブボタンとコンテンツをリセット
          tabButtons.forEach((btn) => {
            btn.classList.remove('active', 'text-cyan-400', 'border-cyan-500');
            btn.classList.add('text-gray-400', 'border-transparent');
          });
          
          tabContents.forEach((content) => {
            content.classList.add('hidden');
          });
          
          // アクティブなタブを設定
          button.classList.add('active', 'text-cyan-400', 'border-cyan-500');
          button.classList.remove('text-gray-400', 'border-transparent');
          
          const targetContent = document.getElementById(`tab-${targetTab}`);
          if (targetContent) {
            targetContent.classList.remove('hidden');
          }
        });
      });
    }
  }
</script>

<style>
  .tab-button.active {
    @apply text-cyan-400 border-cyan-500;
  }
  
  .tab-content {
    animation: fade-in 0.3s ease-out;
  }
</style>
