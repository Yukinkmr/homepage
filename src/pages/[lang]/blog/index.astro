---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Section from '../../../components/Section.astro';
import Card from '../../../components/Card.astro';
import { t } from '../../../i18n/utils';
import { getCollection } from 'astro:content';
import type { Lang } from '../../../i18n/utils';

export async function getStaticPaths() {
  return [
    { params: { lang: 'ja' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params as { lang: Lang };
const title = t('blog.title', lang);

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter((post) => post.data.lang === lang)
  .sort((a, b) => {
    const dateA = new Date(a.data.date);
    const dateB = new Date(b.data.date);
    return dateB.getTime() - dateA.getTime();
  });
---

<BaseLayout title={title} lang={lang}>
  <div class="w-full mx-auto px-6 md:px-8 lg:px-12 xl:px-16 py-12">
    <Section 
      title={title}
      description={lang === 'ja' ? 'ブログ記事一覧' : 'Blog posts'}
    >
      {posts.length === 0 ? (
        <p class="text-gray-400 text-center py-12">
          {t('blog.noPosts', lang)}
        </p>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {posts.map((post) => (
            <Card
              title={post.data.title}
              summary={post.data.description}
              date={post.data.date}
              tags={post.data.tags}
              href={`/${lang}/blog/${post.slug}/`}
            />
          ))}
        </div>
      )}
    </Section>
  </div>
</BaseLayout>
