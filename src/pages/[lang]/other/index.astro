---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Section from '../../../components/Section.astro';
import Card from '../../../components/Card.astro';
import { t } from '../../../i18n/utils';
import type { Lang } from '../../../i18n/utils';
import portfolioData from '../../../data/portfolio.json';

export async function getStaticPaths() {
  return [
    { params: { lang: 'ja' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params as { lang: Lang };
const base = import.meta.env.BASE_URL;
const title = t('nav.other', lang);

const items = portfolioData.other || [];
const sortedItems = [...items].sort((a, b) => {
  const dateA = a.date || '';
  const dateB = b.date || '';
  return dateB.localeCompare(dateA);
});

const getTitle = (item: { title_ja: string; title_en: string }) => 
  lang === 'ja' ? item.title_ja : item.title_en;
const getSummary = (item: { summary_ja: string; summary_en: string }) => 
  lang === 'ja' ? item.summary_ja : item.summary_en;
---

<BaseLayout title={title} lang={lang}>
  <div class="w-full mx-auto px-6 md:px-8 lg:px-12 xl:px-16 py-12">
    <div class="mb-6">
      <a 
        href={`${base}${lang}/#other`}
        target="_self"
        class="inline-flex items-center text-cyan-400 hover:text-cyan-300 transition-colors font-medium"
      >
        ← {t('common.backToHome', lang)}
      </a>
    </div>
    <Section 
      title={title}
      description={lang === 'ja' ? 'その他の実績一覧' : 'Other achievements'}
    >
      {sortedItems.length === 0 ? (
        <p class="text-gray-400 text-center py-12">
          {lang === 'ja' ? '実績がありません' : 'No items found'}
        </p>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {sortedItems.map((item) => (
            <Card
              title={getTitle(item)}
              summary={getSummary(item)}
              date={item.date}
              tags={item.tags}
              links={item.links}
              image={item.image ? `${base}${item.image.replace(/^\//, '').split('/').map(encodeURIComponent).join('/')}` : undefined}
            />
          ))}
        </div>
      )}
    </Section>
  </div>
</BaseLayout>
